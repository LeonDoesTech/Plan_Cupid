<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Your Date Letter</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&family=Roboto:wght@300;400;500&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="icon" type="image/png" href="Logo.jpg">
</head>
<body class="letter-page">
    <div class="letter-container">
        <!-- Customization Panel -->
        <div class="customization-panel">
            <div class="panel-header">
                <h2><i class="fas fa-palette"></i> Customize Letter</h2>
                <button class="panel-toggle" onclick="togglePanel()">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <div class="panel-content">
                <!-- Font Customization -->
                <div class="customization-group">
                    <h3>Font Settings</h3>
                    <div class="form-group">
                        <label for="fontFamily">Font Family</label>
                        <select id="fontFamily" onchange="updateLetterStyle()">
                            <option value="Poppins">Poppins</option>
                            <option value="Dancing Script">Dancing Script</option>
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Arial">Arial</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fontSize">Font Size</label>
                            <input type="range" id="fontSize" min="12" max="28" value="16" onchange="updateLetterStyle()">
                            <span id="fontSizeValue">16px</span>
                        </div>
                        <div class="form-group">
                            <label for="textColor">Text Color</label>
                            <input type="color" id="textColor" value="#333333" onchange="updateLetterStyle()">
                        </div>
                    </div>
                </div>

                <!-- Background Settings -->
                <div class="customization-group">
                    <h3>Background</h3>
                    <div class="form-group">
                        <label for="bgType">Background Type</label>
                        <select id="bgType" onchange="updateBackgroundType()">
                            <option value="color">Solid Color</option>
                            <option value="gradient">Gradient</option>
                            <option value="custom">Custom Image</option>
                        </select>
                    </div>
                    
                    <div id="bgColorGroup" class="form-group">
                        <label for="bgColor">Background Color</label>
                        <input type="color" id="bgColor" value="#ffffff" onchange="updateLetterStyle()">
                    </div>
                    
                    <div id="bgGradientGroup" class="form-group" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gradientColor1">Color 1</label>
                                <input type="color" id="gradientColor1" value="#ff6b6b" onchange="updateLetterStyle()">
                            </div>
                            <div class="form-group">
                                <label for="gradientColor2">Color 2</label>
                                <input type="color" id="gradientColor2" value="#4ecdc4" onchange="updateLetterStyle()">
                            </div>
                        </div>
                    </div>
                    
                    <div id="bgCustomGroup" class="form-group" style="display: none;">
                        <label for="bgImage">Upload Image</label>
                        <input type="file" id="bgImage" accept="image/*" onchange="handleImageUpload(event)">
                    </div>
                </div>

                <!-- Border Color Settings -->
                <div class="customization-group">
                    <h3>Border Color</h3>
                    <div class="form-group">
                        <label for="borderColor">Detail Item Border Color</label>
                        <input type="color" id="borderColor" value="#e91e63" onchange="updateBorderColor()">
                    </div>
                </div>

                <!-- Letter Templates -->
                <div class="customization-group">
                    <h3>Templates</h3>
                    <div class="template-options">
                        <button class="template-btn active" onclick="setTemplate('classic')" data-template="classic">
                            Classic
                        </button>
                        <button class="template-btn" onclick="setTemplate('romantic')" data-template="romantic">
                            Romantic
                        </button>
                        <button class="template-btn" onclick="setTemplate('modern')" data-template="modern">
                            Modern
                        </button>
                        <button class="template-btn" onclick="setTemplate('casual')" data-template="casual">
                            Casual
                        </button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="panel-actions">
                    <button class="btn-secondary" onclick="resetToDefault()">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                    <button class="btn-primary" onclick="downloadLetter()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        </div>

        <!-- Letter Preview -->
        <div class="letter-preview">
            <div class="letter-content" id="letterContent">
                <div class="letter-header">
                    <h1 id="letterTitle">Date Invitation</h1>
                    <div class="date-text" id="dateText"></div>
                    <div class="personal-info">
                        <div class="to-from">
                            <span class="to-text">To: <strong id="toPersonName"></strong></span>
                            <span class="from-text">From: <strong id="fromPersonName"></strong></span>
                        </div>
                    </div>
                </div>
                
                <div class="letter-body">
                    <div class="greeting">
                        <p>You're invited to a special date!</p>
                    </div>
                    
                    <div class="date-details" id="dateDetails">
                        <!-- Date details will be populated here -->
                    </div>
                    
                    <div class="closing">
                        <p>Looking forward to spending this wonderful time together!</p>
                        <div class="signature">
                            <p>With love â™¥</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="preview-actions">
                <button class="btn-secondary" onclick="window.location.href='index.html'">
                    <i class="fas fa-arrow-left"></i> Back to Planner
                </button>
            </div>
        </div>
    </div>

    <script>
        let dateData = {};
        let currentTemplate = 'classic';

        // Load date data when page loads
        window.onload = function() {
            const storedData = localStorage.getItem('dateData');
            if (storedData) {
                dateData = JSON.parse(storedData);
                populateLetter();
            } else {
                // Fallback data if none exists
                window.location.href = 'index.html';
            }
            updateBackgroundType();
            updateLetterStyle();
        };

        function populateLetter() {
            // Update personal info
            if (dateData.fromPerson) {
                document.getElementById('fromPersonName').textContent = dateData.fromPerson;
            }
            if (dateData.toPerson) {
                document.getElementById('toPersonName').textContent = dateData.toPerson;
            }

            // Update date text
            if (dateData.date) {
                const date = new Date(dateData.date);
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('dateText').textContent = date.toLocaleDateString('en-US', options);
            }

            // Populate date details
            const detailsContainer = document.getElementById('dateDetails');
            let detailsHTML = '';

            if (dateData.date && dateData.timeStart) {
                const timeText = dateData.timeEnd ? 
                    `${formatTime(dateData.timeStart)} to ${formatTime(dateData.timeEnd)}` : 
                    formatTime(dateData.timeStart);
                
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-calendar"></i> When</h3>
                        <p>${formatDate(dateData.date)} at ${timeText}</p>
                    </div>
                `;
            }

            if (dateData.place) {
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-map-marker-alt"></i> Where</h3>
                        <p>${dateData.place}</p>
                    </div>
                `;
            }

            if (dateData.whatToDo) {
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-heart"></i> What We'll Do</h3>
                        <p>${dateData.whatToDo}</p>
                    </div>
                `;
            }

            if (dateData.whatToWear) {
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-tshirt"></i> What to Wear</h3>
                        <p>${dateData.whatToWear}</p>
                    </div>
                `;
            }

            if (dateData.transportType) {
                let transportText = '';
                if (dateData.transportType === 'pickup' && dateData.pickupLocation) {
                    transportText = `I'll pick you up at: ${dateData.pickupLocation}`;
                } else if (dateData.transportType === 'meetup' && dateData.meetupLocation) {
                    transportText = `Let's meet at: ${dateData.meetupLocation}`;
                } else {
                    transportText = dateData.transportType === 'pickup' ? "I'll pick you up" : "Let's meet up";
                }
                
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-car"></i> Transportation</h3>
                        <p>${transportText}</p>
                    </div>
                `;
            }

            if (dateData.purpose) {
                let purposeText = dateData.purpose;
                if (dateData.purpose === 'custom' && dateData.customPurpose) {
                    purposeText = dateData.customPurpose;
                } else if (dateData.purpose !== 'custom') {
                    // Convert purpose to readable format
                    purposeText = dateData.purpose.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                }
                
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-star"></i> Purpose</h3>
                        <p>${purposeText}</p>
                    </div>
                `;
            }

            if (dateData.thingsToBring) {
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-luggage-cart"></i> Things to Bring</h3>
                        <p>${dateData.thingsToBring}</p>
                    </div>
                `;
            }

            if (dateData.additionalNotes) {
                detailsHTML += `
                    <div class="detail-item">
                        <h3><i class="fas fa-sticky-note"></i> Additional Notes</h3>
                        <p>${dateData.additionalNotes}</p>
                    </div>
                `;
            }

            detailsContainer.innerHTML = detailsHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const date = new Date();
            date.setHours(parseInt(hours), parseInt(minutes));
            return date.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function updateLetterStyle() {
            const letterContent = document.getElementById('letterContent');
            const fontFamily = document.getElementById('fontFamily').value;
            const fontSize = document.getElementById('fontSize').value;
            const textColor = document.getElementById('textColor').value;
            
            const fontFamilyValue = fontFamily.includes(' ') ? 
                `"${fontFamily}", sans-serif` : `${fontFamily}, sans-serif`;
            
            letterContent.style.setProperty('font-family', fontFamilyValue, 'important');
            letterContent.style.setProperty('font-size', fontSize + 'px', 'important');
            letterContent.style.setProperty('color', textColor, 'important');
            
            // Apply color to all text elements
            const textElements = letterContent.querySelectorAll('h1, h2, h3, p, span, strong');
            textElements.forEach(el => {
                el.style.setProperty('color', textColor, 'important');
            });
            
            document.getElementById('fontSizeValue').textContent = fontSize + 'px';
            
            updateBackground();
        }

        function updateBackgroundType() {
            const bgType = document.getElementById('bgType').value;
            
            // Hide all background groups
            document.getElementById('bgColorGroup').style.display = 'none';
            document.getElementById('bgGradientGroup').style.display = 'none';
            document.getElementById('bgCustomGroup').style.display = 'none';
            
            // Show selected group
            if (bgType === 'color') {
                document.getElementById('bgColorGroup').style.display = 'block';
            } else if (bgType === 'gradient') {
                document.getElementById('bgGradientGroup').style.display = 'block';
            } else if (bgType === 'custom') {
                document.getElementById('bgCustomGroup').style.display = 'block';
            }
            
            updateBackground();
        }

        function updateBackground() {
            const letterContent = document.getElementById('letterContent');
            const bgType = document.getElementById('bgType').value;
            
            // Clear any existing background styles
            letterContent.style.background = '';
            letterContent.style.backgroundImage = '';
            letterContent.style.backgroundSize = '';
            letterContent.style.backgroundPosition = '';
            letterContent.style.backgroundRepeat = '';
            
            if (bgType === 'color') {
                const bgColor = document.getElementById('bgColor').value;
                letterContent.style.background = bgColor;
            } else if (bgType === 'gradient') {
                const color1 = document.getElementById('gradientColor1').value;
                const color2 = document.getElementById('gradientColor2').value;
                letterContent.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
            }
        }

        function updateBorderColor() {
            const borderColor = document.getElementById('borderColor').value;
            const detailItems = document.querySelectorAll('.detail-item');
            
            detailItems.forEach(item => {
                item.style.setProperty('border-left-color', borderColor, 'important');
            });
            
            // Update h3 colors in detail items
            const detailHeadings = document.querySelectorAll('.detail-item h3, .detail-item h3 i');
            detailHeadings.forEach(heading => {
                heading.style.setProperty('color', borderColor, 'important');
            });
        }

        function setTemplate(templateName) {
            // Remove active class from all template buttons
            document.querySelectorAll('.template-btn').forEach(btn => btn.classList.remove('active'));
            // Add active class to clicked button
            event.target.classList.add('active');
            
            currentTemplate = templateName;
            const letterContent = document.getElementById('letterContent');
            
            // Reset classes
            letterContent.className = 'letter-content';
            letterContent.classList.add('template-' + templateName);
            
            // Apply template-specific styles
            if (templateName === 'romantic') {
                document.getElementById('fontFamily').value = 'Dancing Script';
                document.getElementById('bgType').value = 'gradient';
                document.getElementById('gradientColor1').value = '#ff9a9e';
                document.getElementById('gradientColor2').value = '#fecfef';
                document.getElementById('borderColor').value = '#d53f8c';
                updateBackgroundType();
            } else if (templateName === 'modern') {
                document.getElementById('fontFamily').value = 'Roboto';
                document.getElementById('bgType').value = 'color';
                document.getElementById('bgColor').value = '#f8f9fa';
                document.getElementById('borderColor').value = '#4a5568';
                updateBackgroundType();
            } else if (templateName === 'casual') {
                document.getElementById('fontFamily').value = 'Poppins';
                document.getElementById('bgType').value = 'color';
                document.getElementById('bgColor').value = '#ffffff';
                document.getElementById('borderColor').value = '#3182ce';
                updateBackgroundType();
            } else { // classic
                document.getElementById('fontFamily').value = 'Playfair Display';
                document.getElementById('bgType').value = 'color';
                document.getElementById('bgColor').value = '#ffffff';
                document.getElementById('borderColor').value = '#e91e63';
                updateBackgroundType();
            }
            
            updateLetterStyle();
            updateBorderColor();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const letterContent = document.getElementById('letterContent');
                    letterContent.style.backgroundImage = `url(${e.target.result})`;
                    letterContent.style.backgroundSize = 'cover';
                    letterContent.style.backgroundPosition = 'center';
                    letterContent.style.backgroundRepeat = 'no-repeat';
                };
                reader.readAsDataURL(file);
            }
        }

        function resetToDefault() {
            document.getElementById('fontFamily').value = 'Poppins';
            document.getElementById('fontSize').value = '16';
            document.getElementById('textColor').value = '#333333';
            document.getElementById('bgType').value = 'color';
            document.getElementById('bgColor').value = '#ffffff';
            document.getElementById('borderColor').value = '#e91e63';
            
            updateBackgroundType();
            updateLetterStyle();
            updateBorderColor();
            setTemplate('classic');
        }

        function togglePanel() {
            const panel = document.querySelector('.customization-panel');
            const toggleBtn = document.querySelector('.panel-toggle i');
            
            panel.classList.toggle('collapsed');
            
            if (panel.classList.contains('collapsed')) {
                toggleBtn.className = 'fas fa-chevron-right';
            } else {
                toggleBtn.className = 'fas fa-chevron-left';
            }
        }

        async function downloadLetter() {
            const letterContent = document.getElementById('letterContent');
            
            try {
                const canvas = await html2canvas(letterContent, {
                    backgroundColor: null,
                    scale: 2,
                    useCORS: true,
                    allowTaint: true
                });
                
                const link = document.createElement('a');
                link.download = `date-letter-${new Date().toISOString().split('T')[0]}.png`;
                link.href = canvas.toDataURL();
                link.click();
            } catch (error) {
                console.error('Error generating image:', error);
                alert('There was an error generating the image. Please try again.');
            }
        }
    </script>
</body>
</html>